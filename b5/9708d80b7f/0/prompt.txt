The calculatePromptAttributionAtStart function silently returns an empty result on multiple error conditions (lines 936-952, 963-971). While this is acceptable for optional attribution tracking, consider logging these errors at Debug level to help diagnose issues where attribution is unexpectedly missing.

For example, if the shadow branch exists but has corruption, or if git operations fail due to permissions issues, the attribution will be silently skipped with no visibility into why. Adding debug logs here (similar to the ones in manual_commit_condensation.go lines 139-177) would improve debuggability.

---

When a file has staged changes, calculatePromptAttributionAtStart reads from the git index (staging area), but WriteTemporary captures from the worktree. If a user has both staged and unstaged changes to the same file, the unstaged changes are captured in the shadow branch but not counted in PromptAttributions. This causes user contributions to be undercounted and agent contributions to be overcounted in the final attribution metrics.

---

Can you explain fully how we handle unstaged changes when the manual commit is done?